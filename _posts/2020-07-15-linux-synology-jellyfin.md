---
layout: post
title:  "群晖系统中使用jellyfin"
date:   2020-07-15 00:00:00 +0000
tags: linux synology
---





虽然在移动端购买了infuse，能够通过smb观看视频，但是在网速不佳（外网）的情况下，观看体验就很差了。这时，我们就需要能够在服务端转码的媒体库。Plex和Emby要开通会员，那么白嫖用户的选择只剩Jellyfin了。

系统： DSM 6.2.3-25426(DS920+)

资料：

1 [使用群晖Docker 安装Jellyfin 家庭影院HTPC 比emby plex好用多了](https://post.smzdm.com/p/a6lnxg3g/)

2 [群晖Jellyfin设置SSL证书开启https访问](https://www.izcv.com/2235.html)

3 [在jellyfin10.5.5中解决ASS字幕无法正常显示的问题](https://post.smzdm.com/p/aoo89e76/)



# 1 安装

安装过程资料1已经很详细了，但有些细节要注意一下：

1. 在选择版本的时候可以选择一个指定的稳定版本，而不是直接使用latest版本。在这里我还是使用了当前的最新版`10.5.5-amd64`。

2. 在创建容器时，要先择以高权限创建，否则将无法开启硬件加速。

3. 需要映射的目录如下：

   * 根据该容器的启动指令，需要映射下面两个目录：

     `/config`：软件的配置文件目录

     `/cache`：软件的缓存目录

   * 对于中文字幕，由于系统缺少相应的字体，需要映射额外的字体目录到下述路径：

     `/usr/share/fonts`

   * 媒体文件目录，以及软链接文件的源文件目录（映射错误会导致无法访问文件）：

     如果软链接是绝对路径，媒体文件目录名随意，只要保证源文件目录和外部路径一致。

     如果软链接是相对路径，媒体文件目录和源文件目录的相对关系需要保持一致。

4. 需要映射端口，默认的HTTP端口为`8096`，HTTPS端口为`8920`，在这里将两个都添加进去。

设置完上面的参数就可以创建容器了，按照惯例，docker容器默认不支持ipv6。

如果需要外网访问，需要在路由器中设置端口转发。



# 2 配置HTTPS

根据资料2设置，新版本的软件和文章中的有些不一样。

证书可以通过openssl转换：

```bash
openssl pkcs12 -export -out "export.pfx" -inkey "private.key" -in "private.cer" -certfile fullchain.cer
```

这里要注意证书链文件中不能含有自己的证书。

然后将证书放到配置文件目录（也可以放到别的目录）。

在后台设置中，不需要填写外部域名了，新版本删除了这个选项。只要填写证书路径和证书密码。

设置保存后重启容器。



# 3 设置中文字体

参照资料3，在`User/Settings/Subtitles`中设置：

* 字幕言偏好选择`Chinese`

* 字幕模式选择`总是显示字幕`

* 烧录字幕选择`所有高级特效格式字幕`

这个设置项是本地的，也就是说在每个设备上都要设置一次。



# 总结

由于服务端转码只是在外网条件下使用，使用频率不高，Jellyfin已经能够满足目前的需求了。况且，DS920+的CPU也承担不了大负载的转码工作。

最后，上面的三个软件都不支持蓝光原盘，在内网中，KODI和infuse还是最佳选择。

